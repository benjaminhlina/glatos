<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data loading methods for the R package glatos • glatos</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data loading methods for the R package glatos">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">glatos</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.7.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_loading.html">Data loading methods for the R package glatos</a>
    </li>
    <li>
      <a href="../articles/data_requirements.html">Data field definitions for the standard *GLATOS* detection export</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Data loading methods for the R package glatos</h1>
            
            <h4 class="date">Updated: 2019-02-04</h4>
      
      
      <div class="hidden name"><code>data_loading.Rmd</code></div>

    </div>

    
    

<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>This vignette describes methods for loading data into the R package <em>glatos</em>. Sections are organized by data type (<em>detections</em>, <em>receiver locations</em>, etc), and each section contains examples for:</p>
<ol style="list-style-type: decimal">
<li><p>data in standardized formats from the Great Lakes Acoustic Telemetry Observation System (GLATOS), the Ocean Tracking Network (OTN), and VEMCO using built-in data loading functions; and</p></li>
<li><p>data in non-standard formats that require loading using non-<em>glatos</em> functions and modification to meet <em>glatos</em> requirements.</p></li>
</ol>
<div id="loading-data-from-glatos-otn-and-vemco" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-data-from-glatos-otn-and-vemco" class="anchor"></a>Loading data from GLATOS, OTN, and VEMCO</h2>
<p>The <em>glatos</em> package contains five functions (see <a href="#built-in-functions">Built-in functions</a>) designed to load data files in standardized formats from the GLATOS, the OTN, and VEMCO. Each data loading function:</p>
<ol style="list-style-type: decimal">
<li><p>loads data into an R session consistently and efficiently using the best available methods and</p></li>
<li><p>returns an object that meets the requirements of <em>glatos</em> package functions.</p></li>
</ol>
<p>Thus, using <em>glatos</em> load functions ensures that resulting data conform to the requirements of other functions in the package (e.g., <em>summarize_detections</em>, <em>detection_bubble_plot</em>) and relieves users from the work of reformatting their data to meet requirements of each specific function.</p>
<div id="built-in-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#built-in-functions" class="anchor"></a>Built-in functions</h3>
<p>The <em>glatos</em> package includes five data loading functions:</p>
<ul>
<li><dl>
<dt><em><strong>read_glatos_detections</strong></em></dt>
<dd>reads detection data from a comma-separated-values text file obtained from the GLATOS Data Portal and returns an object of class <em>glatos_detections</em> that is also a <em>data.frame</em>.
</dd>
</dl></li>
<li><dl>
<dt><em><strong>read_otn_detections</strong></em></dt>
<dd>reads detection data from a comma-separated-values text file obtained from the Ocean Tracking Network and returns an object of class <em>glatos_detections</em> that is also a <em>data.frame</em>.
</dd>
</dl></li>
<li><dl>
<dt><em><strong>read_glatos_receivers</strong></em></dt>
<dd>reads receiver data from a comma-separated-values text file obtained from the GLATOS Data Portal and returns an object of class <em>glatos_receivers</em> that is also a <em>data.frame</em>.
</dd>
</dl></li>
<li><dl>
<dt><em><strong>read_glatos_workbook</strong></em></dt>
<dd>reads data from a GLATOS project-specific MS Excel workbook (*.xlsm file) and returns a list of class <em>glatos_workbook</em> with two-elements; one of class <em>glatos_receivers</em> and one of class <em>glatos_animals</em> (both are also <em>data.frame</em>s).
</dd>
</dl></li>
<li><dl>
<dt><em><strong>read_vemco_tag_specs</strong></em></dt>
<dd>reads tag specification data from an MS Excel workbook (*.xls file) provided by VEMCO and returns a list with two elements; one containing tag specifications and one containing tag operating schedules. (both are also <em>data.frame</em>s).
</dd>
</dl></li>
</ul>
</div>
<div id="data-objects-and-classes" class="section level3">
<h3 class="hasAnchor">
<a href="#data-objects-and-classes" class="anchor"></a>Data objects and classes</h3>
<p>Most of the functions listed above return an object with a <em>glatos</em>-specific S3 class name (e.g., <em>glatos_detections</em>) in addition to a more general class (e.g., <em>data.frame</em>). Currently, no methods exist for <em>glatos</em> classes and such classes are not explicitly required by any function, so <em>glatos</em> classes can merely be thought of as labels showing that the objects were produced by a <em>glatos</em> function and will therefore be compatible with other <em>glatos</em> functions. Beware, as with any S3 class, that it is possible to modify a <em>glatos</em> object to the point that is will no longer be compatible with <em>glatos</em> functions. The <a href="data_requirements.html">Data Requirements vignette</a> provides an overview of data requirements of <em>glatos</em> functions.</p>
</div>
</div>
<div id="loading-data-from-other-sources" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-data-from-other-sources" class="anchor"></a>Loading data from other sources</h2>
<p>To use <em>glatos</em> functions with data that are not in one of the standard formats described above, those data will need to be:</p>
<ol style="list-style-type: decimal">
<li><p>loaded into R using some other function (e.g., <em>read_csv</em>) and</p></li>
<li><p>modified to ensure that all requirements of the desired function are met.</p></li>
</ol>
<p>Strictly speaking, there are no requirements of the package as a whole, but input data are checked within each individual function to determine if requirements are met. Nonetheless, the <a href="data_requirements.html">Data Requirements vignette</a> provides a set of data requirements, including column names, types, and formats, that will ensure compatibility with all <em>glatos</em> functions.</p>
<p>For each data type (e.g., <em>detection</em>, <em>receiver location</em>, etc), this vignette shows how data from a comma-separated-values text file can be loaded into R using non-<em>glatos</em> functions and then modified to meet the <em>glatos</em> requirements.</p>
</div>
<div id="tips-to-improve-speed-and-efficiency" class="section level2">
<h2 class="hasAnchor">
<a href="#tips-to-improve-speed-and-efficiency" class="anchor"></a>Tips to improve speed and efficiency</h2>
<p>The main examples in the this vignette use only base R functions. However, there are many contributed packages that can provide functions that can improve workflow speed and efficiency. After most examples using base R functions, boxed examples are also given to expose users to alternative examples using functions from contributed packages. Most boxed tips show use of functions from the <em>data.table</em> package. If you are not familiar with <em>data.table</em>, then read through the introductory vignette (see <code><a href="https://cran.rstudio.com/web/packages/data.table/vignettes/datatable-intro.html">vignette("datatable-intro", package = "data.table")</a></code>). For more on <em>data.table</em>, see the vignettes (<code><a href="https://www.rdocumentation.org/packages/utils/topics/browseVignettes">browseVignettes("data.table")</a></code>). In addition to <em>data.table</em>, one boxed tip draws from the <em>lubridate</em> package because it is, to our knowledge, the fastest way to coerce timestamps strings to the date-time class <em>POSIXct</em>. No other examples show use of <em>tidyverse</em> packages (<em>dplyr</em>, <em>ggplot2</em>, <em>readr</em>), simply because some of us have not yet drunk the kool-aid. A future version of this vignette may include more examples using the <em>tidyverse</em> or other packages.</p>
<p>A few notes about boxed-example code:</p>
<ol style="list-style-type: decimal">
<li>Make sure the relevant packages are installed and attached:</li>
</ol>
<blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">#install.packages("data.table")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(data.table)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#install.packages("lubridate")</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lubridate)</a></code></pre></div>
</blockquote>
<ol start="2" style="list-style-type: decimal">
<li>For <em>data.table</em> functions, make sure you’ve converted the target object to <em>data.table</em> class using <em>setDT</em>:</li>
</ol>
<blockquote>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">dx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">a =</span> <span class="dv">1</span> , <span class="dt">b =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">setDT</span>(dx) <span class="co">#convert to data.table</span></a></code></pre></div>
</blockquote>
<ol start="3" style="list-style-type: decimal">
<li>Go all-in; don’t run some base R examples and some boxed example or it will cause trouble. For example if base R example changes column names in an object, then the old column names won’t exist if you later run the boxed example that changes those same column names using <em>data.table</em> functions.</li>
</ol>
</div>
</div>
<div id="detection-data" class="section level1">
<h1 class="hasAnchor">
<a href="#detection-data" class="anchor"></a>Detection data</h1>
<div id="requirements" class="section level2">
<h2 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h2>
<p><em>glatos</em> functions that accept detection data as input will typically require a <em>data.frame</em>. Please refer to “Data field definitions of standard GLATOS detection export” vignette and function help (e.g., <code><a href="../reference/read_glatos_detections.html">?read_glatos_detections</a></code>) to identify data type and definition of mandatory fields (link).</p>
<p>mandatory fields: - detection_timestamp_utc (link) - receiver_sn (link) - deploy_lat (link) - deploy_long (link) - transmitter_codespace (link) - transmitter_id (link) - sensor_value (link) - sensor_unit (link) - animal_id (link)</p>
<p>Additionally, some functions will require at least one categorical column to identify location (or group of locations). These can be specified by the user, but examples of such columns in a GLATOS standard detection file are:</p>
<ul>
<li>glatos_array (link)</li>
<li>station (link)</li>
<li>glatos_project_receiver (link)</li>
</ul>
<p>Any <em>data.frame</em> that contains the above columns should be compatible with all <em>glatos</em> functions that accept detection data as input. Use of the data loading functions <em>read_glatos_detections</em> and <em>read_otn_detections</em> will ensure that these columns are present, but can only be used on data in GLATOS and OTN formats. Data in other formats will need to be loaded using other functions (e.g., <em>read.csv()</em>, <em>data.table::fread()</em>, etc.) and compatibility with <em>glatos</em> functions will need to be carefully checked.</p>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<div id="loading-glatos-data" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-glatos-data" class="anchor"></a>Loading GLATOS data</h3>
<p>The <em>read_glatos_detections()</em> function reads in detection data from standard detection exports (*.csv files) obtained from the GLATOS standard data export and checks that the data meet requirements of <em>glatos</em> functions. Data are read using <em>fread</em> in the <em>data.table</em> package, timestamps are formatted as class <em>POSIXct</em> and dates are formatted as class <em>Date</em>.</p>
<p>First, we will use <em>system.file()</em> to get the path to the walleye_detections.csv file included in the <em>glatos</em> package.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Set path to walleye_detections.csv example dataset</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">wal_det_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">'extdata'</span>, <span class="st">'walleye_detections.csv'</span>, <span class="dt">package =</span> <span class="st">'glatos'</span>)</a></code></pre></div>
<p>Next, we will load data from <em>walleye_detection.csv</em> using <em>read_glatos_detections()</em> and view the structure of the resulting data frame.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Attach glatos package to global environment.</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(glatos)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; version 0.2.7.9000 ('three-meat-pizza')</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co"># Read in the walleye_detections.csv file using `read_glatos_detections()`</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">walleye_detections &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_glatos_detections.html">read_glatos_detections</a></span>(wal_det_file)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co"># View the structure and data from first row</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(walleye_detections)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; Classes 'glatos_detections' and 'data.frame':    7180 obs. of  30 variables:</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; $ animal_id : chr "153" ...</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; $ detection_timestamp_utc : POSIXct, format: "2012-04-29 01:48:37" ...</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; $ glatos_array : chr "TTB" ...</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; $ station_no : chr "2" ...</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; $ transmitter_codespace : chr "A69-9001" ...</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; $ transmitter_id : chr "32054" ...</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; $ sensor_value : num NA NA ...</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; $ sensor_unit : chr NA ...</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; $ deploy_lat : num 43.4 ...</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; $ deploy_long : num -84 ...</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt; $ receiver_sn : chr "113213" ...</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; $ tag_type : chr NA ...</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; $ tag_model : chr NA ...</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt; $ tag_serial_number : chr NA ...</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt; $ common_name_e : chr "walleye" ...</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt; $ capture_location : chr "Tittabawassee River" ...</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt; $ length : num 0.565 0.565 ...</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt; $ weight : num NA NA ...</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt; $ sex : chr "F" ...</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">#&gt; $ release_group : chr NA ...</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#&gt; $ release_location : chr "Tittabawassee" ...</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#&gt; $ release_latitude : num NA NA ...</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="co">#&gt; $ release_longitude : num NA NA ...</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="co">#&gt; $ utc_release_date_time : POSIXct, format: "2012-03-20 20:00:00" ...</span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="co">#&gt; $ glatos_project_transmitter: chr "HECWL" ...</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="co">#&gt; $ glatos_project_receiver : chr "HECWL" ...</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="co">#&gt; $ glatos_tag_recovered : chr "NO" ...</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="co">#&gt; $ glatos_caught_date : Date, format: NA ...</span></a>
<a class="sourceLine" id="cb4-39" data-line-number="39"><span class="co">#&gt; $ station : chr "TTB-002" ...</span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"><span class="co">#&gt; $ min_lag : num 258 137 ...</span></a></code></pre></div>
<p>The result is an object with 30 columns (including the columns described above) and two classes: <em>glatos_detections</em> and <em>data.frame</em>. Please refer to “Data field definitions of standard GLATOS detection export” vignette for field definitions (link). The <em>glatos_detections</em> class label indicates that the data set was created using a glatos load function and therefore should work with any <em>glatos</em> function that accepts detection data as input.</p>
</div>
<div id="loading-otn-data" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-otn-data" class="anchor"></a>Loading OTN data</h3>
<p>The <em>read_otn_detections()</em> function reads in detection data (*.csv files) obtained from the Ocean Tracking Network and reformats the data to meet requirements of <em>glatos</em> functions. Data are read using <em>fread</em> in the <em>data.table</em> package, timestamps are formatted as class <em>POSIXct</em> and dates are formatted as class <em>Date</em>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Read in the blue_shark_detections.csv file using `read_glatos_detections()`</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">shrk_det_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"blue_shark_detections.csv"</span>,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                         <span class="dt">package =</span> <span class="st">"glatos"</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co"># Read in the blue_shark_detections.csv file using `read_otn_detections()`</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">blue_shark_detections &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_otn_detections.html">read_otn_detections</a></span>(shrk_det_file)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co"># View the structure of blue_shark_detections</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(blue_shark_detections)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; Classes 'glatos_detections' and 'data.frame':    3000 obs. of  34 variables:</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; $ collectioncode : chr "NSBS" ...</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; $ animal_id : chr "NSBS-Hooker" ...</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; $ scientificname : chr "Prionace glauca" ...</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; $ commonname : chr "blue shark" ...</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; $ datelastmodified : Date, format: "2014-12-18" ...</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; $ detectedby : chr "HFX" ...</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; $ receiver_sn : chr "HFX" ...</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt; $ glatos_array : chr "HFX047" ...</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt; $ receiver : chr "146" ...</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; $ bottom_depth : num 151 151 ...</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; $ receiver_depth : num 146 146 ...</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt; $ transmitter_id : chr "A69-9001-24395" ...</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt; $ transmitter_codespace : chr "A69-9001" ...</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt; $ sensorname : chr NA ...</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt; $ sensorraw : num NA NA ...</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt; $ sensortype : chr "pinger" ...</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt; $ sensorvalue : num NA NA ...</span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29"><span class="co">#&gt; $ sensorunit : chr NA ...</span></a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="co">#&gt; $ detection_timestamp_utc: POSIXct, format: "2014-08-29 06:11:09" ...</span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="co">#&gt; $ timezone : chr "UTC" ...</span></a>
<a class="sourceLine" id="cb5-32" data-line-number="32"><span class="co">#&gt; $ deploy_long : num -63.2 ...</span></a>
<a class="sourceLine" id="cb5-33" data-line-number="33"><span class="co">#&gt; $ deploy_lat : num 44.2 ...</span></a>
<a class="sourceLine" id="cb5-34" data-line-number="34"><span class="co">#&gt; $ st_setsrid_4326 : chr "0101000020E61000008A1F63EE5A9E4FC04F1E166A4D1B4640" ...</span></a>
<a class="sourceLine" id="cb5-35" data-line-number="35"><span class="co">#&gt; $ yearcollected : int 2014 2014 ...</span></a>
<a class="sourceLine" id="cb5-36" data-line-number="36"><span class="co">#&gt; $ monthcollected : int 8 8 ...</span></a>
<a class="sourceLine" id="cb5-37" data-line-number="37"><span class="co">#&gt; $ daycollected : int 29 29 ...</span></a>
<a class="sourceLine" id="cb5-38" data-line-number="38"><span class="co">#&gt; $ julianday : int 241 241 ...</span></a>
<a class="sourceLine" id="cb5-39" data-line-number="39"><span class="co">#&gt; $ timeofday : num 6.19 ...</span></a>
<a class="sourceLine" id="cb5-40" data-line-number="40"><span class="co">#&gt; $ datereleasedtagger : Date, format: NA ...</span></a>
<a class="sourceLine" id="cb5-41" data-line-number="41"><span class="co">#&gt; $ datereleasedpublic : Date, format: NA ...</span></a>
<a class="sourceLine" id="cb5-42" data-line-number="42"><span class="co">#&gt; $ local_area : chr "HALIFAX" ...</span></a>
<a class="sourceLine" id="cb5-43" data-line-number="43"><span class="co">#&gt; $ notes : chr NA ...</span></a>
<a class="sourceLine" id="cb5-44" data-line-number="44"><span class="co">#&gt; $ citation : chr "Hebert, D., Barthelotte, J., O'Dor, R., Stokesbury, M., Branton,</span></a>
<a class="sourceLine" id="cb5-45" data-line-number="45"><span class="co">#&gt;    R. 2009. Ocean Tracking Network Halifax Canada"| __truncated__ ...</span></a>
<a class="sourceLine" id="cb5-46" data-line-number="46"><span class="co">#&gt; $ unqdetecid : chr "HFX-A69-9001-24395-180148" ...</span></a></code></pre></div>
<p>The result shares the same classes as the walleye dataset (<em>glatos_detections</em> and <em>data.frame</em>), but has 34 columns, most of which are not shared between OTN and GLATOS networks. Thus, <em>read_otn_detections</em> has only altered those OTN-specific columns needed to meet requirements of <em>glatos</em> functions. Field definitions and data types can be found in “Data field definitions of standard GLATOS detection export” vignette (link).</p>
</div>
<div id="other-formats---csv-file-exported-from-a-vue-database" class="section level3">
<h3 class="hasAnchor">
<a href="#other-formats---csv-file-exported-from-a-vue-database" class="anchor"></a>Other formats - CSV file exported from a VUE database</h3>
<p>Detection data in any format than GLATOS or OTN will need to be<br>
modified to meet the requirements of <em>glatos</em> functions. We will show an example using detection data that have been exported from a VEMCO VUE database. There is currently no <em>glatos</em> function to load detection data directly into an R session from VUE software, so data in that format will need to be loaded using other functions and then carefully checked that it meets requirements described above.</p>
<p>In the example below, we will use the base R functions <em>read.csv()</em> and <em>as.POSIXct()</em> to load detection data from a csv file and reformat the data to be consistent with the schema described above. Tip boxes will also show faster alternatives for these methods using functions in the <em>data.table</em> and <em>lubridate</em> packages.</p>
<p>First, get the path to a file (*.csv) that contains detection data exported from VEMCO VUE software. Such a file is not included in the <em>glatos</em> package but we can create one using the <em>glatos</em> function <em>vrl2csv()</em> which exports detection data from a VEMCO *.vrl file using VUE’s built-in command line conversion program. The <em>vrl2csv()</em> function requires a working copy of Vemco VUE on your computer. VUE can be downloaded from <a href="https://vemco.com/products/vue-software" class="uri">https://vemco.com/products/vue-software</a>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">#get path to example VRL included with glatos package</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">vrl_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"VR2W_109924_20110718_1.vrl"</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                        <span class="dt">package =</span> <span class="st">"glatos"</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#convert the vrl file to csv</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#note that vrl2csv writes the csv to disk and returns the path to the csv</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">csv_file &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vrl2csv.html">vrl2csv</a></span>(vrl_file) <span class="co">#file name input</span></a></code></pre></div>
<p>Now that we have the path to a VUE export file, we will read the data using <em>read.csv()</em>. In this case we are also setting some <em>read.csv()</em> arguments to non-default values. First, we set <code>as.is = TRUE</code> so that character values are treated as characters and not converted to factors. Second, we set <code>check.names = FALSE</code> to prevent conversion of syntactically-invalid column names to syntactically valid names. This simply keeps the names exactly as they appear in the source text file rather than, for example, replacing spaces with “.”. This does mean that we need to wrap those column names in back-ticks when called (e.g., <code>my_det$`Sensor Value`</code>). Third, we set <code>fileEncoding = "UTF-8-BOM"</code> to match the encoding of the text file. If this argument is omitted then you might see the special characters <code>﻿</code> added to the first column name. Setting the <em>fileEncoding</em> may also slow down the import.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">dtc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(csv_file, <span class="dt">as.is =</span> <span class="ot">TRUE</span>, <span class="dt">check.names =</span> <span class="ot">FALSE</span>,  </a>
<a class="sourceLine" id="cb7-2" data-line-number="2">                <span class="dt">fileEncoding =</span> <span class="st">"UTF-8-BOM"</span>)</a></code></pre></div>
<blockquote>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><strong>data.table tip:</strong> Use <em>fread</em> instead of <em>read.csv</em>.</p>
</blockquote>
<blockquote>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#read data from csv file using data.table::fread</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">dtcc &lt;-<span class="st"> </span><span class="kw">fread</span>(csv_file)  </a></code></pre></div>
<p><em>fread</em> is fast. That’s one reason it is used used by <em>read_glatos_detections</em> and other <em>glatos</em> functions.<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
</blockquote>
<p>Now we will reformat to be consistent with a <em>glatos_detections</em> object. We will do this for each of the mandatory columns described above.</p>
<div id="detection_timestamp_utc" class="section level4">
<h4 class="hasAnchor">
<a href="#detection_timestamp_utc" class="anchor"></a><em><strong>detection_timestamp_utc</strong></em>
</h4>
<p>Change the column name from <em>Date and Time (UTC)</em> to <em>detection_timestamp_utc</em> and format as <em>POSIXct</em>. We could reference columns by number in the code below (e.g., <code>names(dtc)[1] &lt;- "detection_timestamp_utc"</code>) but use of <code><a href="https://www.rdocumentation.org/packages/base/topics/match">match()</a></code> to get the column number is robust to changes in column order.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">#change column name</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(dtc)[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/match">match</a></span>(<span class="st">"Date and Time (UTC)"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(dtc))] &lt;-<span class="st"> "detection_timestamp_utc"</span></a></code></pre></div>
<blockquote>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><strong>data.table tip:</strong> Use <em>setnames</em> to change column names.</p>
</blockquote>
<blockquote>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">#use data.table::setnames to change column names via old and new names</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">setnames</span>(dtc, <span class="st">"Date and Time (UTC)"</span>, <span class="st">"detection_timestamp_utc"</span>) </a></code></pre></div>
<p>Notice that there is no assignment operator (<em>&lt;-</em>) in this code. This is<br>
because <em>setnames</em>, like other <em>data.table</em> functions, updates the target object (in this case <em>dtc</em>) directly (aka: “by reference”).<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
</blockquote>
<p>We will format the timestamp column using base R function <em>as.POSIXct()</em>. All <em>POSIXct</em> objects are stored internally as a number representing the number of elapsed seconds since “1970-01-01 00:00:00” in UTC. When we convert a character string to <em>POSIXct</em>, we need to tell R <em>how</em> to convert it–namely the time zone of the input data. By default, <em>as.POSIXct</em> will assume your local system time zone (e.g., the one returned by <code><a href="https://www.rdocumentation.org/packages/base/topics/timezones">Sys.timezone()</a></code>. To prevent timezone errors, <em>always</em> specify time zone (using the <em>tz</em> argument) whenever you coerce any timestamp to <em>POSIXct</em>. In this case, the timestamps were exported from VUE in UTC, so we use the following:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">dtc<span class="op">$</span>detection_timestamp_utc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(dtc<span class="op">$</span>detection_timestamp_utc,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">                                                  <span class="dt">tz =</span> <span class="st">"UTC"</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(dtc<span class="op">$</span>detection_timestamp_utc)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt;  POSIXct[1:69708], format: "2011-04-11 20:17:49" ...</span></a></code></pre></div>
<blockquote>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><strong>data.table tip:</strong> Use <em>:=</em> to add or modify a column.</p>
</blockquote>
<blockquote>
<p><em>:=</em> is an assignment operator for <em>data.table</em> objects that assigns objects by reference. We use because it is more compact than base R methods.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">#use ':=" to update format of timestamps</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">dtc[ , detection_timestamp_utc <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(detection_timestamp_utc,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">                                             <span class="dt">tz =</span> <span class="st">"UTC"</span>)]</a></code></pre></div>
<p>Notice again that assignment operators <em>&lt;-</em> or <em>=</em> in this code because <em>dtc</em> is updated by reference.<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
</blockquote>
<blockquote>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><strong>lubridate tip:</strong> Use <em>fast_strptime</em> to set timestamps.</p>
</blockquote>
<blockquote>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">#lubridate::fast_strptime is the fastest way we know to ceorce strings to POSIX</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">dtc[ , detection_timestamp_utc <span class="op">:</span><span class="er">=</span><span class="st">  </span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">         </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/parse_date_time.html">fast_strptime</a></span>(detection_timestamp_utc,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">                                  <span class="dt">format =</span> <span class="st">"%Y-%m-%d %H:%M:%OS"</span>,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">                                  <span class="dt">tz =</span> <span class="st">"UTC"</span>,</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">                                  <span class="dt">lt =</span> <span class="ot">FALSE</span>)]</a></code></pre></div>
<p>Notice that we formatted the timestamps using <em>fast_strptime</em> but also used <em>data.table</em>’s <em>set</em> operator (<em>:=</em>) to assign it to the target column.<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
</blockquote>
</div>
<div id="receiver_sn" class="section level4">
<h4 class="hasAnchor">
<a href="#receiver_sn" class="anchor"></a><em><strong>receiver_sn</strong></em>
</h4>
<p>There is no single column in the VUE export data with receiver serial number, so we need to extract it from the <em>Receiver</em> column.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co">#make new function to extract second element from a hyphen-delimited string</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">get_rsn &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(x, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#apply get_rsn() to each record in Receiver column</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">dtc<span class="op">$</span>receiver_sn &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(dtc<span class="op">$</span>Receiver, get_rsn)</a></code></pre></div>
<blockquote>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><strong>data.table tip:</strong> Use <em>by</em> argument in <em>data.table</em> to update a column by groups.</p>
</blockquote>
<blockquote>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">#make new column "receiver_sn"; parse from "Receiver"</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">dtc[ , receiver_sn <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">get_rsn</span>(Receiver), by =<span class="st"> "Receiver"</span>]</a></code></pre></div>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
</blockquote>
</div>
<div id="deploy_lat-and-deploy_long" class="section level4">
<h4 class="hasAnchor">
<a href="#deploy_lat-and-deploy_long" class="anchor"></a><em><strong>deploy_lat</strong></em> and <em><strong>deploy_long</strong></em>
</h4>
<p>The <em>Latitude</em> and <em>Longitude</em> values are all zero in this data set, because the<br>
VUE database from which these data were exported did not have any latitude or longitude data. We need to get them from another source. These example data only contain one receiver, but to demonstrate how this can be done, we will make a new data frame with these data and merge it.</p>
<p>The code below shows a simple left join on <em>receiver_sn</em>, which assigns the same receiver location data to all detection records on that receiver without time consideration. Two limitations of this simple join are that it:</p>
<ul>
<li>is inadequate if any receiver is deployed at more than one location.</li>
<li>includes detections that occurred before receiver deployment and after receiver recovery.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">#make an example receiver data frame</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">rcv &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">        <span class="dt">glatos_array =</span> <span class="st">"DWM"</span>,</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">        <span class="dt">station =</span> <span class="st">"DWM-001"</span>, </a>
<a class="sourceLine" id="cb16-5" data-line-number="5">        <span class="dt">deploy_lat =</span> <span class="fl">45.65738</span>, </a>
<a class="sourceLine" id="cb16-6" data-line-number="6">        <span class="dt">deploy_long =</span> <span class="fl">-84.46418</span>, </a>
<a class="sourceLine" id="cb16-7" data-line-number="7">        <span class="dt">deploy_date_time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(<span class="st">"2011-04-11 20:30:00"</span>, <span class="dt">tz =</span> <span class="st">"UTC"</span>),</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">        <span class="dt">recover_date_time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(<span class="st">"2011-07-08 17:11:00"</span>, <span class="dt">tz =</span> <span class="st">"UTC"</span>),</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">        <span class="dt">ins_serial_no =</span> <span class="st">"109924"</span>,</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">        <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb16-11" data-line-number="11"></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#merge </span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13">dtc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge</a></span>(dtc, rcv, <span class="dt">by.x =</span> <span class="st">"receiver_sn"</span>, <span class="dt">by.y =</span> <span class="st">"ins_serial_no"</span>)</a>
<a class="sourceLine" id="cb16-14" data-line-number="14"></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co"># take a look</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(dtc)</a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt;   receiver_sn detection_timestamp_utc    Receiver    Transmitter Transmitter Name</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt; 1      109924     2011-04-11 20:17:49 VR2W-109924 A69-1303-63366               NA</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co">#&gt; 2      109924     2011-05-08 05:38:32 VR2W-109924  A69-9002-4043               NA</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="co">#&gt; 3      109924     2011-05-08 05:41:09 VR2W-109924  A69-9002-4043               NA</span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="co">#&gt; 4      109924     2011-05-08 05:43:14 VR2W-109924  A69-9002-4043               NA</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22"><span class="co">#&gt; 5      109924     2011-05-08 05:44:15 VR2W-109924  A69-9002-4043               NA</span></a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="co">#&gt; 6      109924     2011-05-08 05:45:59 VR2W-109924  A69-9002-4043               NA</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24"><span class="co">#&gt;   Transmitter Serial Sensor Value Sensor Unit Station Name Latitude Longitude</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25"><span class="co">#&gt; 1                 NA           NA                       NA        0         0</span></a>
<a class="sourceLine" id="cb16-26" data-line-number="26"><span class="co">#&gt; 2                 NA            5         ADC           NA        0         0</span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="co">#&gt; 3                 NA            7         ADC           NA        0         0</span></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"><span class="co">#&gt; 4                 NA            4         ADC           NA        0         0</span></a>
<a class="sourceLine" id="cb16-29" data-line-number="29"><span class="co">#&gt; 5                 NA            5         ADC           NA        0         0</span></a>
<a class="sourceLine" id="cb16-30" data-line-number="30"><span class="co">#&gt; 6                 NA           16         ADC           NA        0         0</span></a>
<a class="sourceLine" id="cb16-31" data-line-number="31"><span class="co">#&gt;   glatos_array station deploy_lat deploy_long    deploy_date_time</span></a>
<a class="sourceLine" id="cb16-32" data-line-number="32"><span class="co">#&gt; 1          DWM DWM-001   45.65738   -84.46418 2011-04-11 20:30:00</span></a>
<a class="sourceLine" id="cb16-33" data-line-number="33"><span class="co">#&gt; 2          DWM DWM-001   45.65738   -84.46418 2011-04-11 20:30:00</span></a>
<a class="sourceLine" id="cb16-34" data-line-number="34"><span class="co">#&gt; 3          DWM DWM-001   45.65738   -84.46418 2011-04-11 20:30:00</span></a>
<a class="sourceLine" id="cb16-35" data-line-number="35"><span class="co">#&gt; 4          DWM DWM-001   45.65738   -84.46418 2011-04-11 20:30:00</span></a>
<a class="sourceLine" id="cb16-36" data-line-number="36"><span class="co">#&gt; 5          DWM DWM-001   45.65738   -84.46418 2011-04-11 20:30:00</span></a>
<a class="sourceLine" id="cb16-37" data-line-number="37"><span class="co">#&gt; 6          DWM DWM-001   45.65738   -84.46418 2011-04-11 20:30:00</span></a>
<a class="sourceLine" id="cb16-38" data-line-number="38"><span class="co">#&gt;     recover_date_time</span></a>
<a class="sourceLine" id="cb16-39" data-line-number="39"><span class="co">#&gt; 1 2011-07-08 17:11:00</span></a>
<a class="sourceLine" id="cb16-40" data-line-number="40"><span class="co">#&gt; 2 2011-07-08 17:11:00</span></a>
<a class="sourceLine" id="cb16-41" data-line-number="41"><span class="co">#&gt; 3 2011-07-08 17:11:00</span></a>
<a class="sourceLine" id="cb16-42" data-line-number="42"><span class="co">#&gt; 4 2011-07-08 17:11:00</span></a>
<a class="sourceLine" id="cb16-43" data-line-number="43"><span class="co">#&gt; 5 2011-07-08 17:11:00</span></a>
<a class="sourceLine" id="cb16-44" data-line-number="44"><span class="co">#&gt; 6 2011-07-08 17:11:00</span></a></code></pre></div>
<p>Note that new columns have been added to <em>dtc</em>, including <em>deploy_lat</em>, <em>deploy_long</em>, and two columns (<em>glatos_array</em> and <em>glatos_station</em>) that could serve as optional location grouping variables. Columns <em>deploy_date_time</em> and <em>recover_date_time</em> (<em>POSIXct</em> objects) are not mandatory columns, but are useful for removing detections that occurred before receiver deployment or after recovery.</p>
<p>We will subset detections to omit any that occurred before deployment or after recovery.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">#count rows before subset</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(dtc)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#&gt; [1] 69708</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#subset deployments between receiver deployment and recovery (omit others)</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">dtc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(dtc, dtc[detection_timestamp_utc <span class="op">&gt;=</span><span class="st"> </span>deploy_date_time <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="st">                     </span>detection_timestamp_utc <span class="op">&lt;=</span><span class="st"> </span>recover_date_time, ])</a></code></pre></div>
<blockquote>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><strong>data.table tip:</strong> Use <em>between</em> to subset records by intervals.</p>
</blockquote>
<blockquote>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co">#subset deployments between receiver deployment and recovery (omit others) </span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">dtc &lt;-<span class="st"> </span>dtc[<span class="kw">between</span>(detection_timestamp_utc,                                 </a>
<a class="sourceLine" id="cb18-3" data-line-number="3">                   deploy_date_time, recover_date_time), ]  </a></code></pre></div>
</blockquote>
<blockquote>
<p>Note that the <em>&lt;-</em> assignment operator is used here because we are subsetting the <em>data.table</em> object <code>dtc</code> and there is no assignment operator inside the square brackets.<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
</blockquote>
<p>We removed five rows.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co">#count rows after subset</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(dtc)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt; [1] 69703</span></a></code></pre></div>
</div>
<div id="transmitter_codespace-and-transmitter_id" class="section level4">
<h4 class="hasAnchor">
<a href="#transmitter_codespace-and-transmitter_id" class="anchor"></a><em><strong>transmitter_codespace</strong></em> and <em><strong>transmitter_id</strong></em>
</h4>
<p>There is no single column in the VUE export data with transmitter code space or transmitter ID code, so we need to extract them from the <em>Transmitter</em> column.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co">#make a new function to extract id from Transmitter</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="co">#i.e., get third element of hyphen-delimited string</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3">parse_tid &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(x, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co">#make a new function to extract codespace from Transmitter</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#i.e., get first two elements of hyphen-delimited string</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7">parse_tcs &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">    <span class="co">#split on "-" and keep first two extracted elements</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9">    tx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(x, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb20-10" data-line-number="10">    <span class="co">#re-combine and separate by "-"</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(tx[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">collapse =</span> <span class="st">"-"</span>))</a>
<a class="sourceLine" id="cb20-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb20-13" data-line-number="13"></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#apply parse_tcs() to Transmitter and assign to transmitter_codespace</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15">dtc<span class="op">$</span>transmitter_codespace &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(dtc<span class="op">$</span>Transmitter, parse_tcs)</a>
<a class="sourceLine" id="cb20-16" data-line-number="16"></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="co">#apply parse_tid() to Transmitter and assign to transmitter_id</span></a>
<a class="sourceLine" id="cb20-18" data-line-number="18">dtc<span class="op">$</span>transmitter_id &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(dtc<span class="op">$</span>Transmitter, parse_tid)</a></code></pre></div>
<blockquote>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><strong>data.table tip:</strong> Use the <em>functional form</em> of <em>:=</em> to add/modify more than one column.</p>
</blockquote>
<blockquote>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">dtc[ , <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">transmitter_codespace =</span> <span class="kw">parse_tcs</span>(Transmitter),                    </a>
<a class="sourceLine" id="cb21-2" data-line-number="2">            <span class="dt">transmitter_id =</span> <span class="kw">parse_tid</span>(Transmitter), </a>
<a class="sourceLine" id="cb21-3" data-line-number="3">       <span class="dt">by =</span> <span class="st">"Transmitter"</span>]  </a></code></pre></div>
</blockquote>
<blockquote>
<p>See <code><a href="https://www.rdocumentation.org/packages/data.table/topics/assign">?data.table::set</a></code> for description and examples of functional form of <code>:=</code>.<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
</blockquote>
</div>
<div id="sensor_value-and-sensor_unit" class="section level4">
<h4 class="hasAnchor">
<a href="#sensor_value-and-sensor_unit" class="anchor"></a><em><strong>sensor_value</strong></em> and <em><strong>sensor_unit</strong></em>
</h4>
<p>Change the column names from <em>‘Sensor Value’</em> and <em>‘Sensor Unit’</em> to <em>sensor_value</em> and <em>sensor_unit</em>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co">#change column name</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(dtc)[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/match">match</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Sensor Value"</span>, <span class="st">"Sensor Unit"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(dtc))] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="st">             </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sensor_value"</span>, <span class="st">"sensor_unit"</span>)</a></code></pre></div>
<blockquote>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><strong>data.table tip</strong><br>
Use <em>setnames</em> to change column names.</p>
</blockquote>
<blockquote>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">setnames</span>(dtc, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Sensor Value"</span>, <span class="st">"Sensor Unit"</span>),</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">              <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sensor_value"</span>, <span class="st">"sensor_unit"</span>))  </a></code></pre></div>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
</blockquote>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(dtc)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="co">#&gt; 'data.frame':    69703 obs. of  19 variables:</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="co">#&gt; $ receiver_sn : chr "109924" ...</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="co">#&gt; $ detection_timestamp_utc: POSIXct, format: "2011-05-08 05:38:32" ...</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="co">#&gt; $ Receiver : chr "VR2W-109924" ...</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="co">#&gt; $ Transmitter : chr "A69-9002-4043" ...</span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="co">#&gt; $ Transmitter Name : logi NA ...</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="co">#&gt; $ Transmitter Serial : logi NA ...</span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="co">#&gt; $ sensor_value : int 5 7 ...</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="co">#&gt; $ sensor_unit : chr "ADC" ...</span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11"><span class="co">#&gt; $ Station Name : logi NA ...</span></a>
<a class="sourceLine" id="cb24-12" data-line-number="12"><span class="co">#&gt; $ Latitude : int 0 0 ...</span></a>
<a class="sourceLine" id="cb24-13" data-line-number="13"><span class="co">#&gt; $ Longitude : int 0 0 ...</span></a>
<a class="sourceLine" id="cb24-14" data-line-number="14"><span class="co">#&gt; $ glatos_array : chr "DWM" ...</span></a>
<a class="sourceLine" id="cb24-15" data-line-number="15"><span class="co">#&gt; $ station : chr "DWM-001" ...</span></a>
<a class="sourceLine" id="cb24-16" data-line-number="16"><span class="co">#&gt; $ deploy_lat : num 45.7 ...</span></a>
<a class="sourceLine" id="cb24-17" data-line-number="17"><span class="co">#&gt; $ deploy_long : num -84.5 ...</span></a>
<a class="sourceLine" id="cb24-18" data-line-number="18"><span class="co">#&gt; $ deploy_date_time : POSIXct, format: "2011-04-11 20:30:00" ...</span></a>
<a class="sourceLine" id="cb24-19" data-line-number="19"><span class="co">#&gt; $ recover_date_time : POSIXct, format: "2011-07-08 17:11:00" ...</span></a>
<a class="sourceLine" id="cb24-20" data-line-number="20"><span class="co">#&gt; $ transmitter_codespace : chr "A69-9002" ...</span></a>
<a class="sourceLine" id="cb24-21" data-line-number="21"><span class="co">#&gt; $ transmitter_id : chr "4043" ...</span></a></code></pre></div>
</div>
<div id="animal_id" class="section level4">
<h4 class="hasAnchor">
<a href="#animal_id" class="anchor"></a><em><strong>animal_id</strong></em>
</h4>
<p>The <em>animal_id</em> column will need to come from another source, like the animal tagging data. We will make a new data frame with these data and merge it.</p>
<p>The code below shows a simple left join on <em>transmitter_codespace</em> and <em>transmitter_id</em>, which assigns the same receiver location data to all detection records of each transmitter without time consideration. Two limitations of this simple join are that it:</p>
<ul>
<li>is inadequate if any transmitter was deployed more than once.</li>
<li>includes detections that occurred before transmitter deployment (animal release) and after transmitter recovery (animal recapture).</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co">#make an example animal (fish) data frame</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">fsh &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">        <span class="dt">animal_id =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"1"</span>, <span class="st">"4"</span>, <span class="st">"7"</span>, <span class="st">"128"</span>), </a>
<a class="sourceLine" id="cb25-4" data-line-number="4">        <span class="dt">tag_code_space =</span> <span class="st">"A69-1601"</span>,</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">        <span class="dt">tag_id_code =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"439"</span>, <span class="st">"442"</span>, <span class="st">"445"</span>, <span class="st">"442"</span>), </a>
<a class="sourceLine" id="cb25-6" data-line-number="6">        <span class="dt">common_name =</span> <span class="st">"Sea Lamprey"</span>, </a>
<a class="sourceLine" id="cb25-7" data-line-number="7">        <span class="dt">release_date_time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"2011-05-05 12:00"</span>, </a>
<a class="sourceLine" id="cb25-8" data-line-number="8">                                         <span class="st">"2011-05-05 12:00"</span>, </a>
<a class="sourceLine" id="cb25-9" data-line-number="9">                                         <span class="st">"2011-05-06 12:00"</span>, </a>
<a class="sourceLine" id="cb25-10" data-line-number="10">                                         <span class="st">"2011-06-08 12:00"</span>), </a>
<a class="sourceLine" id="cb25-11" data-line-number="11">                                       <span class="dt">tz =</span> <span class="st">"UTC"</span>),</a>
<a class="sourceLine" id="cb25-12" data-line-number="12">        <span class="dt">recapture_date_time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="ot">NA</span>, <span class="st">"2011-05-26 15:00"</span>, <span class="ot">NA</span>, <span class="ot">NA</span>),</a>
<a class="sourceLine" id="cb25-13" data-line-number="13">                                         <span class="dt">tz =</span> <span class="st">"UTC"</span>), </a>
<a class="sourceLine" id="cb25-14" data-line-number="14">        <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb25-15" data-line-number="15"></a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="co">#simple left join on codespace and id</span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17">dtc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge</a></span>(dtc, fsh, <span class="dt">by.x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"transmitter_codespace"</span>, <span class="st">"transmitter_id"</span>), </a>
<a class="sourceLine" id="cb25-18" data-line-number="18">                       <span class="dt">by.y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"tag_code_space"</span>, <span class="st">"tag_id_code"</span>))</a>
<a class="sourceLine" id="cb25-19" data-line-number="19">          </a></code></pre></div>
<p>Note that one tag was re-used, but we did not account for this in the above merge (a simple left join). So we now need to subset to omit records that occurred before release or after recapture.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co">#subset detections to include only those between release and recapture </span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co"># or after release if never recaptured</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3">dtc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(dtc, dtc[detection_timestamp_utc <span class="op">&gt;=</span><span class="st"> </span>release_date_time <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="st">                     </span>(detection_timestamp_utc <span class="op">&lt;=</span><span class="st"> </span>recapture_date_time <span class="op">|</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="st">                       </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(recapture_date_time)), ])</a></code></pre></div>
<blockquote>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><strong>data.table tip</strong><br>
Use <em>between</em> to query records or evaluate statements by intervals.</p>
</blockquote>
<blockquote>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">dtc &lt;-<span class="st"> </span>dtc[<span class="kw">between</span>(detection_timestamp_utc, release_date_time,</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">                   recapture_date_time) <span class="op">|</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(recapture_date_time), ] </a></code></pre></div>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
</blockquote>
<p>We should now have a detection dataset that will meet the requirements of <em>glatos</em> functions.</p>
</div>
</div>
</div>
</div>
<div id="receiver-location-data" class="section level1">
<h1 class="hasAnchor">
<a href="#receiver-location-data" class="anchor"></a>Receiver location data</h1>
<div id="requirements-1" class="section level2">
<h2 class="hasAnchor">
<a href="#requirements-1" class="anchor"></a>Requirements</h2>
<p><em>glatos</em> functions that accept receiver location data as input will typically require a <em>data.frame</em> with one or more of the following columns. Please refer to “Data field definitions of standard GLATOS detection export” vignette and function help (e.g., <code><a href="../reference/read_glatos_detections.html">?read_glatos_detections</a></code>) to identify data type and definition of mandatory fields (link).</p>
<p>mandatory fields: - deploy_lat (link) - deploy_long (link) - deploy_date_time (link) - recover_date_time (link)</p>
<p>Additionally, some functions will require at least one categorical column to identify location (or group of locations). These can be specified by the user, but examples of such columns in a GLATOS standard detection file are:</p>
<ul>
<li>glatos_array (link)</li>
<li>station (link)</li>
<li>glatos_project_receiver (link)</li>
</ul>
</div>
<div id="examples-1" class="section level2">
<h2 class="hasAnchor">
<a href="#examples-1" class="anchor"></a>Examples</h2>
<div id="loading-glatos-data-1" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-glatos-data-1" class="anchor"></a>Loading GLATOS data</h3>
<p>The <em>read_glatos_receivers()</em> function reads in receiver location data obtained from the GLATOS standard data export and checks that the data meet requirements of <em>glatos</em> functions. Data are read using <em>fread</em> in the <em>data.table</em> package, timestamps are formatted as class <em>POSIXct</em>.</p>
<p>We will get the path to the <em>sample_receivers.csv</em> (example included in the <em>glatos</em> package) using use <em>system.file()</em>, then read the data using <em>read_glatos_receivers()</em>, and view the structure of the result.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co">#get path to example receiver_locations file</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">rec_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, </a>
<a class="sourceLine" id="cb28-3" data-line-number="3">                        <span class="st">"sample_receivers.csv"</span>, <span class="dt">package =</span> <span class="st">"glatos"</span>)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4"></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="co">#read sample_receivers.csv using 'read_glatos_receivers()'</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6">rcv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_glatos_receivers.html">read_glatos_receivers</a></span>(rec_file)</a>
<a class="sourceLine" id="cb28-7" data-line-number="7"></a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="co">#view structure</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(rcv)</a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="co">#&gt; Classes 'glatos_receivers' and 'data.frame': 898 obs. of  23 variables:</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="co">#&gt; $ station : chr "WHT-009" ...</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12"><span class="co">#&gt; $ glatos_array : chr "WHT" ...</span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="co">#&gt; $ station_no : chr "9" ...</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14"><span class="co">#&gt; $ consecutive_deploy_no: int 1 2 ...</span></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="co">#&gt; $ intend_lat : num NA NA ...</span></a>
<a class="sourceLine" id="cb28-16" data-line-number="16"><span class="co">#&gt; $ intend_long : num NA NA ...</span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17"><span class="co">#&gt; $ deploy_lat : num 43.7 ...</span></a>
<a class="sourceLine" id="cb28-18" data-line-number="18"><span class="co">#&gt; $ deploy_long : num -82.5 ...</span></a>
<a class="sourceLine" id="cb28-19" data-line-number="19"><span class="co">#&gt; $ recover_lat : num NA NA ...</span></a>
<a class="sourceLine" id="cb28-20" data-line-number="20"><span class="co">#&gt; $ recover_long : num NA NA ...</span></a>
<a class="sourceLine" id="cb28-21" data-line-number="21"><span class="co">#&gt; $ deploy_date_time : POSIXct, format: "2010-09-22 18:05:00" ...</span></a>
<a class="sourceLine" id="cb28-22" data-line-number="22"><span class="co">#&gt; $ recover_date_time : POSIXct, format: "2012-08-15 16:52:00" ...</span></a>
<a class="sourceLine" id="cb28-23" data-line-number="23"><span class="co">#&gt; $ bottom_depth : num NA NA ...</span></a>
<a class="sourceLine" id="cb28-24" data-line-number="24"><span class="co">#&gt; $ riser_length : num NA NA ...</span></a>
<a class="sourceLine" id="cb28-25" data-line-number="25"><span class="co">#&gt; $ instrument_depth : num NA NA ...</span></a>
<a class="sourceLine" id="cb28-26" data-line-number="26"><span class="co">#&gt; $ ins_model_no : chr "VR2W" ...</span></a>
<a class="sourceLine" id="cb28-27" data-line-number="27"><span class="co">#&gt; $ glatos_ins_frequency : int 69 69 ...</span></a>
<a class="sourceLine" id="cb28-28" data-line-number="28"><span class="co">#&gt; $ ins_serial_no : chr "109450" ...</span></a>
<a class="sourceLine" id="cb28-29" data-line-number="29"><span class="co">#&gt; $ deployed_by : chr "" ...</span></a>
<a class="sourceLine" id="cb28-30" data-line-number="30"><span class="co">#&gt; $ comments : chr "" ...</span></a>
<a class="sourceLine" id="cb28-31" data-line-number="31"><span class="co">#&gt; $ glatos_seasonal : chr "NO" ...</span></a>
<a class="sourceLine" id="cb28-32" data-line-number="32"><span class="co">#&gt; $ glatos_project : chr "HECWL" ...</span></a>
<a class="sourceLine" id="cb28-33" data-line-number="33"><span class="co">#&gt; $ glatos_vps : chr "NO" ...</span></a></code></pre></div>
<p>The result is an object with 23 columns (including the prescribed columns described above) and two classes: <em>glatos_receivers</em> and <em>data.frame</em>. The <em>glatos_receivers</em> class label indicates that the data set was created using a <em>glatos</em> load function and therefore should work with any <em>glatos</em> function that accepts receiver data as input.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#overview">Overview</a><ul class="nav nav-pills nav-stacked">
<li><a href="#loading-data-from-glatos-otn-and-vemco">Loading data from GLATOS, OTN, and VEMCO</a></li>
      <li><a href="#loading-data-from-other-sources">Loading data from other sources</a></li>
      <li><a href="#tips-to-improve-speed-and-efficiency">Tips to improve speed and efficiency</a></li>
      </ul>
</li>
      <li>
<a href="#detection-data">Detection data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#requirements">Requirements</a></li>
      <li><a href="#examples">Examples</a></li>
      </ul>
</li>
      <li>
<a href="#receiver-location-data">Receiver location data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#requirements-1">Requirements</a></li>
      <li><a href="#examples-1">Examples</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Christopher Holbrook, Todd Hayden, Thomas Binder, Jon Pye, Alex Nunes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
